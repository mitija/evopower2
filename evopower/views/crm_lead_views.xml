<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="evo_show_all_leads" model="ir.ui.view">
    <field name="name">crm.lead.view.form.inherited</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
    <field name="arch" type="xml">
      <xpath expr="//filter[@name='assigned_to_me']" position="attributes">
        <attribute name="domain">["|", ("user_id", "=", uid), "|", ("active", "=", True), ("active", "=", False)]</attribute>
      </xpath>
    </field>
  </record>

  <record id="evo_leads_customer" model="ir.ui.view">
    <field name="name">crm.lead.view.form.inherited2</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_lead_view_form"/>
    <field name="arch" type="xml">
      <xpath expr="//group[@name='lead_partner']/field[@name='partner_name']" position="attributes">
        <attribute name="invisible">1</attribute>
      </xpath>

      <xpath expr="//group[@name='lead_partner']/field[@name='partner_name']" position="after">
        <field name="partner_id" widget="res_partner_many2one" string="Customer" context="{'default_name': contact_name or partner_name,  'default_street': street,'default_is_company': type == 'opportunity' and contact_name == False,'default_company_name': type == 'opportunity' and partner_name,'default_street2': street2,'default_city': city,'default_title': title,'default_state_id': state_id,'default_zip': zip,'default_country_id': country_id,'default_function': function,'default_phone': phone,'default_mobile': mobile,'default_email': email_from,'default_user_id': user_id,'default_team_id': team_id,'default_website': website,'default_lang': lang_code,'show_vat': True,}"/>
      </xpath>

      <xpath expr="//field[@name='tag_ids']" position="after">
        <field name="state_id" string="Location" />
      </xpath>

      <xpath expr="//group[@name='opportunity_partner']" position="after">
        <group name="evo_opportunity_form">
          <field name="epc"/>
          <field name="last_contact_date"/>
          <field name="follow_up_comments" />
          <field name="nominal_value" />
        </group>
      </xpath>

      <xpath expr="//field[@name='partner_id']" position="attributes">
        <attribute name="invisible">1</attribute>
      </xpath>

      <field name="user_id" position="attributes">
        <attribute name="string">Owner</attribute>
      </field>

      <field name="expected_revenue" position="attributes">
        <attribute name="string">Potential Opportunity</attribute>
      </field>

      <field name="probability" position="attributes">
        <attribute name="string">Chance of Sale</attribute>
      </field>

      <notebook position="inside">
        <page string="Product" name="crm_product">
          <field name="product_ids" widget="one2many">
            <tree string="Add Product" editable="bottom" deletable="true" delete="1">
              <field name="product_ids" string="System"/>
              <field name="solution" />
              <field name="power_kW_product"/>
              <field name="usable_kWh_product" />
              <field name="quantity" />
              <field name="product_price" widget="monetary" options="{'currency_field': 'company_currency'}"/>
              <field name="subtotal" sum="subtotal" widget="monetary" options="{'currency_field': 'company_currency'}"/>
              <field name="company_currency" invisible="1"/>
              <field name="power_kW_opportunity" sum="Power kW Total"/>
              <field name="usable_kWh_opportunity" sum="Usable kWh Total"/>
              <field name="product_subtotal" />
            </tree>
          </field>
        </page>
      </notebook>

    </field>
  </record>

  <record id="evo_lost_reason" model="ir.ui.view">
    <field name="name">crm.lead.tree.opportunity.inherit</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_case_tree_view_oppor"/>
    <field name="arch" type="xml">
      <xpath expr="//field[@name='probability']" position="before">
        <field name="lost_reason_name"/>
        <field name="lost_feedback"/>
      </xpath>
    </field>
  </record>

  <record id="evo_kanban_view_inherit" model="ir.ui.view">
    <field name="name">crm.lead.kanban.inherit</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
    <field name="arch" type="xml">
      <xpath expr="//t[@t-name='kanban-box']//div[contains(@class, 'o_dropdown_kanban')]" position="before">
        <widget name="web_ribbon" title="Won" attrs="{'invisible': [('probability', '&lt;', 100)]}"/>
      </xpath>
    </field>
  </record>

  <record id="sales_opportunity_report" model="ir.ui.view">
    <field name="name">sales.opportunity.register</field>
    <field name="model">crm.lead</field>
    <field name="type">tree</field>
    <field name="arch" type="xml">
      <tree create='false'>
        <field name="stage_id" string="Project Status"/>
        <field name="name" string="Project Name"/>
        <field name="epc" />
        <field name="create_date" widget="date" string="Date Entered"/>
        <field name="user_id" string="Owner"/>
        <field name="state_id" string="Location"/>
        <field name="comments"/>
        <field name="solution_all"/>
        <field name="system_all" string="System"/>
        <field name="follow_up_comments"/>
        <field name="last_contact_date" />
        <field name="power_kW_opportunity"/>
        <field name="usable_kWh_opportunity"/>
        <field name="nominal_value" />
        <field name="expected_revenue" sum="Potential Opportunity" string="Potential Opportunity" widget="monetary" options="{'currency_field': 'company_currency'}"/>
        <field name="company_currency" invisible="1"/>
        <field name="chance_of_sale" string="Chance of Sale" widget="percentage"/>
        <field name="date_deadline" string="Potential PO Date"/>
        <field name="weighted_forecast" widget="monetary" options="{'currency_field': 'company_currency'}" string="$ Weighted Forecast"/>
        <field name="kw_weighted_forecast"/>
        <field name="kwh_weighted_forecast"/>
        <field name="weighted_nominal" />
      </tree>
    </field>

  </record>

  <record id="action_sales_opportunity_register" model="ir.actions.act_window">
    <field name="name">Sales Opportunity Register</field>
    <field name="res_model">crm.lead</field>
    <field name="view_mode">tree,form,pivot</field>
    <field name="view_id" ref="sales_opportunity_report"></field>
  </record>

  <menuitem id="evo_sale_opportunity" name="Sale Opportunity Register" parent="crm.crm_menu_report" action="action_sales_opportunity_register" sequence="6"/>

</odoo>
